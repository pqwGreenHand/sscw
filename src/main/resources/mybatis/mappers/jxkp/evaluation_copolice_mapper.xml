<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhixin.zhfz.jxkp.dao.jxkp.copoliceMapper">
	<!-- <typeAlias alias="alarm" type="com.zhixin.rd.interrogate.web.entity.AlarmEntity" /> -->


	<select id="getCopoliceList" resultType="com.zhixin.zhfz.jxkp.entity.CopoliceEntity" parameterType="java.util.Map">
		select `xt_user`.login_name,ep.user_id mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) xbsl from
		evaluation e,
		eva_join ep,
		`xt_user`,
		xt_organization o
		where e.id=ep.eva_id
		AND `xt_user`.id = ep.user_id
		AND o.id = `xt_user`.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY ep.user_id
		ORDER BY count(*) DESC
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getCopoliceListCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from
		evaluation e,
		eva_join ep,
		`xt_user`,
		xt_organization o
		where e.id=ep.eva_id
		AND `xt_user`.id = ep.user_id
		AND o.id = `xt_user`.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY ep.user_id
		ORDER BY count(*) DESC
	</select>

	<select id="getCopoliceSelect" resultType="com.zhixin.zhfz.jxkp.entity.CopoliceOrg" parameterType="java.util.Map">
		select o.id,o.organization from xt_organization o where o.id &gt; 2
	</select>

	<select id="getxbajsl"  resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e,eva_join ep

		where e.id = ep.eva_id
		AND ep.user_id = #{mjid}
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		GROUP BY  e.case_no
	</select>


	<select id="getajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e
		where  e.police_id = #{mjid}

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		GROUP BY case_no
	</select>

	<select id="getEvaluationList" resultType="com.zhixin.zhfz.jxkp.entity.Mainpolice" parameterType="java.util.Map">
		select
		`xt_user`.login_name,e.police_id mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) kpsl,SUM(e.pointsvalue) kfsum
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.police_id
		AND o.id = `xt_user`.organization_id

		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY police_id
		order by kfsum Asc
		limit #{pageStart},#{pageEnd}
	</select>
	<select id="getEvaluationListCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select
		count(*)
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.police_id

		AND o.id = `xt_user`.organization_id

		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY police_id
	</select>

	<select id="getdutypolice" resultType="com.zhixin.zhfz.jxkp.entity.Mainpolice" parameterType="java.util.Map">
		select
		`xt_user`.login_name,ex.dutypolice_id mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) kpsl,SUM(ex.pointsvalue) kfsum
		from evaluation e,
		eva_examine ex,
		`xt_user`,
		xt_organization o
		WHERE
		e.id = ex.eva_id
		AND ex.dutypolice_id = `xt_user`.id
		AND o.id = xt_user.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="mjid2!=null ">
			and ex.dutypolice_id = #{mjid}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY ex.dutypolice_id
		order by kfsum Asc
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getdutypoliceCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from (select
		`xt_user`.login_name,ex.dutypolice_id mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) kpsl,SUM(ex.pointsvalue) kfsum
		from evaluation e,
		eva_examine ex,
		`xt_user`,
		xt_organization o
		WHERE
		e.id = ex.eva_id
		AND ex.dutypolice_id = `xt_user`.id
		AND o.id = xt_user.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="mjid2!=null ">
			and ex.dutypolice_id = #{mjid}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY ex.dutypolice_id) b
	</select>


	<select id="getzerenajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e,eva_examine ex
		where e.id = ex.eva_id
		and ex.dutypolice_id = #{mjid}

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		GROUP BY e.case_no
	</select>

	<select id="getzerenkpsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e,eva_examine ex
		where e.id = ex.eva_id
		and ex.dutypolice_id = #{mjid}

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		GROUP BY e.id
	</select>


	<select id="getleadership" resultType="com.zhixin.zhfz.jxkp.entity.Mainpolice" parameterType="java.util.Map">
		select
		`xt_user`.login_name,e.leader_id mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) kpsl,SUM(e.pointsvalue)/2 kfsum
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.leader_id
		AND o.id = `xt_user`.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY e.leader_id
		ORDER BY kfsum Asc
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getleadershipCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select
		count(*)
		from evaluation e,
		`xt_user`,

		xt_organization o
		WHERE
		`xt_user`.id = e.leader_id
		AND o.id = `xt_user`.organization_id
		<if test="mjbm!=null">
			AND o.id = #{mjbm}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>

		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>

		GROUP BY e.leader_id
		ORDER BY AVG(e.scorevalue) DESC
	</select>

	<select id="getleadershipajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e left join xt_organization o on e.oraganizationId = o.id
		where  e.leader_id = #{mjid}

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null ">
			and   ${dataAuth}
		</if>
		GROUP BY case_no
	</select>


	<select id="getbjtj" resultType="com.zhixin.zhfz.jxkp.entity.BJTJEntity" parameterType="java.util.Map">
		select e.case_type ajlxid,count(*) kpzs,AVG(e.scorevalue) avg,SUM(e.pointsvalue) as kfsum from evaluation e LEFT  join xt_organization org   on   e.oraganizationId =  org.id
		where
		1=1
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="dw!=null ">
			and e.oraganizationId =  #{dw}
		</if>
		<if test="dataAuth!=null ">
			and   ${dataAuth}
		</if>
		GROUP BY e.case_type
	</select>

	<select id="getbjajsl" resultType="java.lang.Integer"  parameterType="java.util.Map">
		select count(*) from evaluation e left join xt_organization org   on   e.oraganizationId =  org.id
		where
		1=1

		<if test="ajlx!=null">
			and e.case_type = #{ajlx}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="dw!=null ">
			and e.oraganizationId = #{dw}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="dataAuth!=null ">
			and   ${dataAuth}
		</if>
		GROUP BY e.case_no
	</select>

	<select id="getbjdwtj" resultType="com.zhixin.zhfz.jxkp.entity.BJDWTJEntity" parameterType="java.util.Map">
		select e.oraganizationId jbdwid,o.name jbdw, count(*) kpsl,SUM(e.pointsvalue) kf_sum from evaluation e,xt_organization o
		where e.oraganizationId = o.id
		<if test="ajlx!=null">
			and e.case_type = #{ajlx}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="dw!=null ">
			and e.oraganizationId = #{dw}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null ">
			and   ${dataAuth}
		</if>
		GROUP BY o.name
		ORDER BY AVG(e.scorevalue) DESC
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getbjdwtjCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e,xt_organization o
		where e.oraganizationId = o.id
		<if test="ajlx!=null">
			and e.case_type = #{ajlx}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="dw!=null ">
			and e.oraganizationId = #{dw}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>
		GROUP BY o.name
		ORDER BY AVG(e.scorevalue) DESC

	</select>

	<select id="getbjdwajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(*) from evaluation e left join xt_organization o on e.oraganizationId = o.id
		WHERE e.oraganizationId = #{jbdw}
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>

		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>
		GROUP BY e.case_no
	</select>

	<select id="getzhibiao" resultType="com.zhixin.zhfz.jxkp.entity.ZhibiaoEntity" parameterType="java.util.Map">
		SELECT q.id,q.item xlh,q.scoring_stand zbbz,count(*) cxcs,SUM(ex.pointsvalue) kfzz,CONCAT(ROUND(SUM(ex.pointsvalue)/tabZkf.zkf *100,2),'','%') as kfzb
		from eva_examine ex,eva_quota q,evaluation e LEFT JOIN xt_organization o on o.id = e.oraganizationId,
		(SELECT SUM(ex.pointsvalue) as zkf
		from eva_examine ex,eva_quota q ,evaluation e LEFT JOIN xt_organization o  on e.oraganizationId = o.id
		WHERE e.id = ex.eva_id
		AND ex.quota_id = q.id
		<if test="bmid!=null and bmid!=''">
			AND e.oraganizationId = #{bmid}
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>) as tabZkf
		WHERE e.id = ex.eva_id
		AND ex.quota_id = q.id
		<if test="bmid!=null and bmid!=''">
			AND e.oraganizationId = #{bmid}
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>

		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		GROUP BY q.id
		ORDER BY count(*) DESC
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getzhibiaoCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(*)
		from eva_examine ex,eva_quota q,evaluation e LEFT JOIN xt_organization o  on e.oraganizationId = o.id
		WHERE e.id = ex.eva_id
		AND ex.quota_id = q.id
		<if test="bmid!=null and bmid!=''">
			AND e.oraganizationId = #{bmid}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY q.id
		ORDER BY SUM(q.pointsvalue) DESC
	</select>

	<select id="getzhibiao_zkf" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT SUM(e.pointsvalue)
		from evaluation e,eva_examine ex,eva_quota q
		WHERE e.id = ex.eva_id
		AND ex.quota_id = q.id
		<if test="bmid!=null and bmid!=''">
			AND e.oraganizationId = #{bmid}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
	</select>
	<select id="getzhibiao_ajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from eva_examine ex,eva_quota q ,evaluation e LEFT JOIN xt_organization o  on e.oraganizationId = o.id
		WHERE e.id = ex.eva_id
		AND  ex.quota_id = q.id
		AND q.id = #{id}
		<if test="bmid!=null and bmid!=''">
			AND e.oraganizationId = #{bmid}
		</if>
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null and dataAuth!=''">
			AND ${dataAuth}
		</if>
		GROUP BY e.case_no
	</select>
	<select id="getzhibiao_kfzd" resultType="com.zhixin.zhfz.jxkp.entity.OrgCountEntity" parameterType="java.util.Map">
		select count(*) as count,a.orgName as orgname ,concat( orgname,'(',count(*),'æ¬¡)') as concatCountOrgName  from
		(SELECT ex.id as exId,ex.quota_id as quotaId,ex.context as context, o.id as orgId,o.name as orgName,ex.dutypolice_id as policeId,ex.eva_id as evaId,eva.id as evaId2
		from eva_examine ex  LEFT JOIN evaluation eva on ex.eva_id = eva.id
		LEFT join xt_organization o on eva.oraganizationId  = o.id
		WHERE  ex.quota_id = #{id}
		<if test="casetype=='xz'">
			and eva.case_type =1
		</if>
		<if test="casetype=='jq'">
			and eva.case_type = 0
		</if>
		<if test="casetype=='xs'">
			and eva.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and eva.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (eva.case_type = 1 or eva.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (eva.case_type = 0 or eva.case_type = 1 or eva.case_type = 2)
		</if>
		<if test="kssj!=null ">
			and eva.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and eva.handle_time &lt;= #{jssj}
		</if>
		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>
		) a
		GROUP BY a.orgId ORDER BY count desc limit 1
	</select>

	<select id="getfazhiyuan" resultType="com.zhixin.zhfz.jxkp.entity.Mainpolice" parameterType="java.util.Map">
		select
		`xt_user`.login_name,e.creater mjid,`xt_user`.real_name mjxm,o.name mjdw,count(*) kpsl,SUM(e.pointsvalue) kfsum
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.creater
		AND o.id = xt_user.organization_id
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>
		GROUP BY e.creater
		ORDER BY count(*) DESC
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="getfazhiyuanCount" resultType="com.zhixin.zhfz.jxkp.entity.Mainpolice" parameterType="java.util.Map">
		select
		count(*)
		from evaluation e,
		`xt_user`,

		xt_organization o
		WHERE
		`xt_user`.id = e.creater
		AND o.id = xt_user.organization_id
		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="dataAuth!=null ">
			and ${dataAuth}
		</if>
		GROUP BY e.creater
		ORDER BY SUM(e.pointsvalue) DESC
	</select>

	<select id="getfzyajsl" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from evaluation e
		where  e.creater = #{mjid}

		<if test="kssj!=null ">
			and e.handle_time &gt;= #{kssj}
		</if>
		<if test="jssj!=null ">
			and e.handle_time &lt;= #{jssj}
		</if>
		<if test="casetype=='jq'">
			and e.case_type = 0
		</if>
		<if test="casetype=='xz'">
			and e.case_type = 1
		</if>
		<if test="casetype=='xs'">
			and e.case_type = 2
		</if>
		<if test="casetype=='zfjd'">
			and e.case_type = 3
		</if>
		<if test="casetype=='xzxs'">
			and (e.case_type = 1 or e.case_type = 2)
		</if>
		<if test="casetype=='all'">
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		</if>
		GROUP BY case_no
	</select>

	<select id="queryquota" resultType="com.zhixin.zhfz.jxkp.entity.QuotaEntity_tqy" parameterType="java.util.Map">
		select * from eva_quota where scoring_stand like '%${st}%' or item like '%${st}%' limit #{pageStart},#{pageEnd}
	</select>

	<select id="maxpage" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from eva_quota where scoring_stand like '%${st}%' or item like '%${st}%'
	</select>

	<select id="getmaxid" resultType="java.lang.Integer">
		select MAX(id) from eva_quota
	</select>

	<insert id="addquota" parameterType="java.util.Map">
		INSERT into eva_quota (id,item,scoring_stand,pointsvalue,type) VALUE(#{id},#{item},#{ss},#{pv},#{type})
	</insert>

	<update id="updatequota" parameterType="java.util.Map">
		UPDATE eva_quota SET id=#{id},item=#{item},scoring_stand=#{ss},pointsvalue=#{pv},type=#{type} where id=#{id}
	</update>

	<delete id="delequota" parameterType="java.util.Map">
		delete from eva_quota where id=#{id}
	</delete>

	<select id="update_getquota" resultType="com.zhixin.zhfz.jxkp.entity.QuotaEntity_tqy" parameterType="java.util.Map">
		select * from eva_quota where id=#{id}
	</select>

	<select id="selectCaseNo" resultType="com.zhixin.zhfz.jxkp.entity.EvaluationEntity_tqy" parameterType="java.util.Map">
		SELECT e.id AS id,e.case_no AS caseNo,e.case_name AS caseName,e.informant,e.suspect,e.case_type AS caseType,e.batch_item_id,e.case_desc,e.oraganizationId,o.name orgname,e.leader_id,e.police_id,e.implementation,e.accordwith,e.remarks,e.scorevalue,e.pointsvalue
		from evaluation e,xt_organization o
		WHERE
		e.oraganizationId = o.id

		<if test="caseNo!=null">
			and e.case_no = #{caseNo}
		</if>
		<if test="caseId!=null">
			and e.id = #{caseId}
		</if>
		ORDER BY e.examine_time DESC LIMIT 0,1
	</select>


	<select id="addevaluationCaseNo" resultType="com.zhixin.zhfz.jxkp.entity.EvaluationEntity_tqy" parameterType="java.util.Map">
		SELECT e.id AS id,e.case_no AS caseNo,e.case_name AS caseName,e.informant,e.suspect,e.case_type AS caseType from evaluation e WHERE e.case_no like  '%${caseno}%' and e.case_name like  '%${casename}%' ORDER BY e.id DESC LIMIT #{pageStart},#{pageEnd}
	</select>

	<select id="count_addevaluationCaseNo" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(*) from evaluation e WHERE e.case_no like  '%${caseno}%' and e.case_name like  '%${casename}%' ORDER BY e.examine_time ASC
	</select>

	<select id="getzhubanbyid" resultType="com.zhixin.zhfz.jxkp.entity.PoliceIdLoginnameRealname" parameterType="java.util.Map">
		select e.police_id AS id,u.login_name AS loginname,u.real_name AS realname from evaluation e,`xt_user` u WHERE e.police_id = u.id and e.id = #{id}
	</select>

	<select id="getlingdaobyid" resultType="com.zhixin.zhfz.jxkp.entity.PoliceIdLoginnameRealname" parameterType="java.util.Map">
		select e.leader_id AS id,u.login_name AS loginname,u.real_name AS realname from evaluation e,`xt_user` u WHERE e.leader_id = u.id and e.id = #{id}
	</select>

	<select id="getxiebanbyid" resultType="com.zhixin.zhfz.jxkp.entity.PoliceIdLoginnameRealname" parameterType="java.util.Map">
		SELECT ej.user_id AS id,u.login_name AS loginname,u.real_name AS realname from evaluation e,eva_join ej,`xt_user` u WHERE e.id = ej.eva_id AND ej.user_id = u.id
		AND e.id = #{id}
	</select>

	<select id="selectAllItem" resultType="com.zhixin.zhfz.jxkp.entity.ItemEntity">
		select * from eva_item
	</select>

	<select id="selectorganization" resultType="com.zhixin.zhfz.jxkp.entity.OrgIdNameEntity" parameterType="java.util.Map" >
		SELECT id,organization orgname FROM `organization` o WHERE o.id>2
		<if test="organization != null and organization != ''">
			and o.organization like '%${organization}%'
		</if>
		limit #{pageStart},#{pageEnd}
	</select>

	<select id="selectorganization_count" resultType="java.lang.Integer" parameterType="java.util.Map" >
		SELECT count(*) FROM `organization` o WHERE o.id>2
		<if test="organization != null and organization != ''">
			and o.organization like '%${organization}%'
		</if>
	</select>

</mapper>


