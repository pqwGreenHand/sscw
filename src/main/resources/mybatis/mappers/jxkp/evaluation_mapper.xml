<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhixin.zhfz.jxkp.dao.jxkp.IevaluationMapper">
	<!-- <typeAlias alias="alarm" type="com.zhixin.rd.interrogate.web.entity.AlarmEntity" /> -->
	<resultMap id="EvaluationMapper" type="com.zhixin.zhfz.jxkp.entity.EvaluationEntity">
		<id column="id" property="id" />
    	<result property="caseNo" column="caseNo"/>
    	<result property="caseName" column="caseName"/>
		<result property="caseDesc" column="caseDesc"/>
		<result property="caseType" column="caseType"/>
		<result property="batchItem" column="batchItem"/>
		<result property="informant" column="informant"/>
		<result property="suspect" column="suspect"/>
		<result property="police" column="police"/>
		<result property="oraganizationName" column="oraganizationName"/>
		<result property="leaderId" column="leaderId"/>
		<result property="createrId" column="createrId"/>
		<result property="handleTime" column="handleTime"/>
		<result property="examineTime" column="examineTime"/>
		<result property="scorevalue" column="scorevalue"/>
		<result property="pointsvalue" column="pointsvalue"/>
		<result property="implementation" column="implementation"/>
		<result property="accordwith" column="accordwith"/>
		<result property="remarks" column="remarks"/>
		<result property="batchItemId" column="batchItemId"/>
		<result property="policeIdZb" column="policeId"/>
		<result property="lawAccording" column="lawAccording"/>
		<result property="existEvidence" column="existEvidence"/>
		<result property="lawerOpinion" column="lawerOpinion"/>
		<result property="oraganizationId" column="oraganizationId"/>
		<result property="leaderId2" column="leaderId2"/>
		<result property="createrId2" column="createrId2"/>
		<result property="policeNo" column="policeNo"/>
		<result property="policeNo2" column="policeNo2"/>
    </resultMap>


	<resultMap id="BatchMapper" type="com.zhixin.zhfz.jxkp.entity.BatchEntity">
	<id column="id" property="id" />
	<result property="caseType" column="caseType"/>
	<result property="content" column="content"/>
	</resultMap>

	<resultMap id="UserMapper" type="com.zhixin.zhfz.common.entity.UserEntity">
		<id column="id" property="id" />
		<result property="loginName" column="loginName"/>
		<result property="realName" column="realName"/>
		<result property="email" column="organization"/>
	</resultMap>

	<resultMap id="quotaMapper" type="com.zhixin.zhfz.jxkp.entity.QuotaEntity">
		<id column="id" property="id" />
		<result property="Item" column="Item"/>
		<result property="ScoringStand" column="ScoringStand"/>
		<result property="PointsValue" column="PointsValue"/>
	</resultMap>

	<resultMap id="evaJoinMapper" type="com.zhixin.zhfz.jxkp.entity.EvaJoinEntity">
		<id column="id" property="id" />
		<result property="evaId" column="evaId"/>
		<result property="userId" column="userId"/>
	</resultMap>

	<resultMap id="examineMapper" type="com.zhixin.zhfz.jxkp.entity.ExamineEntity">
		<id column="id" property="id" />
		<result property="quotaId" column="quotaId"/>
		<result property="dutypoliceId" column="dutypoliceId"/>
		<result property="context" column="context"/>
		<result property="pointsValue" column="pointsValue"/>
		<result property="dutyPoliceNameAndNo" column="dutyPoliceNameAndNo"/>
		<result property="status" column="status"/>
	</resultMap>
	<resultMap id="askStatusMapper" type="com.zhixin.zhfz.jxkp.entity.AskStatusEntity">
		<id column="id" property="id" />
		<result property="evaId" column="evaId"/>
		<result property="askUserId" column="askUserId"/>
		<result property="oldDfz" column="oldDfz"/>
		<result property="oldKfz" column="oldKfz"/>
		<result property="newDfz" column="newDfz"/>
		<result property="newKfz" column="newKfz"/>
		<result property="status" column="status"/>
		<result property="replyLeaderId" column="replyLeaderId"/>
		<result property="createTime" column="createTime"/>
		<result property="realNameAsk" column="realNameAsk"/>
		<result property="realNameReply" column="realNameReply"/>
		<result property="ajbh" column="ajbh"/>
		<result property="ajmc" column="ajmc"/>
		<result property="caseType" column="caseType"/>
	</resultMap>

	<resultMap id="rateMapper" type="com.zhixin.zhfz.jxkp.entity.ExamineRateEntity">
		<id column="id" property="id" />
		<result property="quotaId" column="quotaId"/>
		<result property="dutypoliceId" column="dutypoliceId"/>
		<result property="context" column="context"/>
		<result property="pointsValue" column="pointsValue"/>
		<result property="dutyPoliceNameAndNo" column="dutyPoliceNameAndNo"/>
		<result property="status" column="status"/>
	</resultMap>

	<resultMap id="configMapper" type="com.zhixin.zhfz.jxkp.entity.gdjzSynConfigEntity">
		<id property="id" column="id"/>
		<result property="name" column="name"/>
		<result property="startTime" column="start_syn_time"/>
		<result property="endSynTime" column="end_syn_time"/>
		<result property="midSynTime" column="mid_syn_time"/>
		<result property="quantity" column="quantity"/>
		<result property="type" column="type"/>
	</resultMap>
	<resultMap id="ajxxMapper" type="com.zhixin.zhfz.jxkp.entity.GdajEntity">
		<id property="id" column="id"/>
		<result property="ajmc" column="ajmc"/>
		<result property="ajbh" column="ajbh"/>
		<result property="jsdwcode" column="zbdw"/>
		<result property="jsdw" column="zbdw_cn"/>
		<result property="ajzt" column="ajstate"/>
		<result property="ajlx" column="ajlx"/>
		<result property="ab" column="ab"/>
		<result property="afsj" column="FASJZZ"/>
		<result property="afdd" column="fadd"/>
		<result property="jyaq" column="zyaq"/>
		<result property="zbmjxm" column="reservation01"/>
		<result property="zbmjh" column="ajzbry"/>
		<result property="jzbh" column="jzbh"/>
		<result property="slsj" column="sljjsj"/>
		<result property="jjslh" column="sl_bjslh"/>
	</resultMap>

	<resultMap id="organizationResultMap" type="com.zhixin.zhfz.common.entity.OrganizationEntity">
		<id column="id" property="id" jdbcType="INTEGER"/>
		<result column="name" property="name" jdbcType="VARCHAR"/>
		<result column="org_code" property="orgCode" jdbcType="VARCHAR"/>
		<result column="type" property="type" jdbcType="VARCHAR"/>
		<result column="address" property="address" jdbcType="VARCHAR"/>
		<result column="telephone" property="telephone" jdbcType="VARCHAR"/>
		<result column="postcode" property="postcode" jdbcType="VARCHAR"/>
		<result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
		<result column="updated_time" property="updatedTime" jdbcType="TIMESTAMP"/>
		<result column="gis" property="gis" jdbcType="VARCHAR"/>
	</resultMap>

	<resultMap id="RateSignMapper" type="com.zhixin.zhfz.jxkp.entity.RateSignEntity">
		<result column="name" property="name" jdbcType="VARCHAR"/>
		<result column="value" property="value" jdbcType="VARCHAR"/>
	</resultMap>
	<!--查询出所有的考评记录 -->
    <select id="selectAllEvaluation" resultMap="EvaluationMapper" parameterType="java.util.Map">
		SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,area.name as oraganizationName,e.leader_id as leaderId2  ,e.creater as createrId2, e.handle_time as handleTime, e.examine_time as examineTime,e.handle_time as handleTime2, e.examine_time as examineTime2, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,u.real_name as police,bat.content as batchItem ,e.law_according as lawAccording,e.exist_evidence as existEvidence,e.lawerOpinion as lawerOpinion,
		u2.login_name as policeNo,
		u3.login_name as policeNo2,
		u4.real_name as leaderId,
		u5.real_name as createrId,
		u6.login_name as policeZbJh
		FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		LEFT  join  `xt_user` u2 on u2.id = e.leader_id
		LEFT  join  `xt_user` u3 on u3.id = e.creater
		LEFT  join  `xt_user` u4 on u4.id = e.leader_id
		LEFT  join  `xt_user` u5 on u5.id = e.creater
		LEFT  join  `xt_user` u6 on u6.id = e.police_id
		WHERE 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			and ${dataAuth}
		</if>
		ORDER  BY  e.id desc
		limit #{pageStart},#{pageEnd}
    </select>
	<!--查询出所有的考评记录的数量 -->
	<select id="selectAllEvaluationCount" resultType="Integer" parameterType="java.util.Map">
		SELECT count(*)
		FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		LEFT  join  `xt_user` u2 on u2.id = e.leader_id
		LEFT  join  `xt_user` u3 on u3.id = e.creater
		LEFT  join  `xt_user` u4 on u4.id = e.leader_id
		LEFT  join  `xt_user` u5 on u5.id = e.creater
		LEFT  join  `xt_user` u6 on u6.id = e.police_id
		WHERE 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			and ${dataAuth}
		</if>
	</select>

	<!-- 带参数查询-->
	<select id="selectAllEvaliationByParam" resultMap="EvaluationMapper" parameterType="java.util.Map">
		SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,area.name as oraganizationName,e.leader_id as leaderId2  ,e.creater as createrId2, e.handle_time as handleTime, e.examine_time as examineTime,e.handle_time as handleTime2, e.examine_time as examineTime2, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,u.real_name as police,bat.content as batchItem ,e.law_according as lawAccording,e.exist_evidence as existEvidence,e.lawerOpinion as lawerOpinion,
		u2.login_name as policeNo,
		u3.login_name as policeNo2,
		u4.real_name as leaderId,
		u5.real_name as createrId,
		u6.login_name as policeZbJh
		FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		LEFT  join  `xt_user` u2 on u2.id = e.leader_id
		LEFT  join  `xt_user` u3 on u3.id = e.creater
		LEFT  join  `xt_user` u4 on u4.id = e.leader_id
		LEFT  join  `xt_user` u5 on u5.id = e.creater
		LEFT  join  `xt_user` u6 on u6.id = e.police_id
		WHERE 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			and ${dataAuth}
		</if>
		<if test="dataAuth2!=null and dataAuth2!=''">
			and ${dataAuth2}
		</if>
		<if test="caseNo!=null and caseNo!=''">
			AND  (e.case_no LIKE CONCAT('%','${caseNo}','%' ))
		</if>
		<if test="caseName!=null and caseName!=''">
			AND  (e.case_name LIKE CONCAT('%','${caseName}','%' ))
		</if>
		<if test="ajxz!=null and ajxz!=100">
			AND  e.case_type = #{ajxz}
		</if>
		<if test="cpsx!=null and cpsx!=100">
			AND  e.batch_item_id = #{cpsx}
		</if>
		<if test="bar!=null and bar!=''">
			AND  e.informant = #{bar}
		</if>
		<if test="xyr!=null and xyr!=''">
			AND  e.suspect = #{xyr}
		</if>
		<if test="jbdw!=null and jbdw!=100">
			AND  ${dataAreaIdsOfSelectOrg}
		</if>
		<if test="lederId!=null and lederId!=''">
			AND  e.leader_id = #{lederId}
		</if>
		<if test="zcyId!=null and zcyId!=''">
			AND  e.police_id = #{zcyId}
		</if>
		<if test="cjr!=null and cjr!=100">
			AND  e.creater = #{cjr}
		</if>
		<if test="startTimeSh!=null and startTimeSh!=''">
			and  e.examine_time &gt;=#{startTimeSh}
		</if>
		<if test="endTimeSh!=null and endTimeSh!=''">
			and  e.examine_time &lt;=#{endTimeSh}
		</if>
		<if test="startTimeBl!=null and startTimeBl!=''">
			and  e.handle_time &gt;=#{startTimeBl}
		</if>
		<if test="endTimeBl!=null and endTimeBl!=''">
			and  e.handle_time &lt;=#{endTimeBl}
		</if> ORDER  BY  e.id desc  limit #{pageStart},#{pageEnd}
	</select>

	<select id="selectAllEvaliationByParamCount" resultType="Integer" parameterType="java.util.Map">
		SELECT count(*)
		FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		LEFT  join  `xt_user` u2 on u2.id = e.leader_id
		LEFT  join  `xt_user` u3 on u3.id = e.creater
		LEFT  join  `xt_user` u4 on u4.id = e.leader_id
		LEFT  join  `xt_user` u5 on u5.id = e.creater
		LEFT  join  `xt_user` u6 on u6.id = e.police_id
		WHERE 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			and ${dataAuth}
		</if>
		<if test="dataAuth2!=null and dataAuth2!=''">
			and ${dataAuth2}
		</if>
		<if test="caseNo!=null and caseNo!=''">
			AND  (e.case_no LIKE CONCAT('%','${caseNo}','%' ))
		</if>
		<if test="caseName!=null and caseName!=''">
			AND  (e.case_name LIKE CONCAT('%','${caseName}','%' ))
		</if>
		<if test="ajxz!=null and ajxz!=100">
			AND  e.case_type = #{ajxz}
		</if>
		<if test="cpsx!=null and cpsx!=100">
			AND  e.batch_item_id = #{cpsx}
		</if>
		<if test="bar!=null and bar!=''">
			AND  e.informant = #{bar}
		</if>
		<if test="xyr!=null and xyr!=''">
			AND  e.suspect = #{xyr}
		</if>
		<if test="jbdw!=null and jbdw!=100">
			AND  ${dataAreaIdsOfSelectOrg}
		</if>
		<if test="lederId!=null and lederId!=''">
			AND  e.leader_id = #{lederId}
		</if>
		<if test="zcyId!=null and zcyId!=''">
			AND  e.police_id = #{zcyId}
		</if>
		<if test="cjr!=null and cjr!=100">
			AND  e.creater = #{cjr}
		</if>
		<if test="startTimeSh!=null and startTimeSh!=''">
			and  e.examine_time &gt;=#{startTimeSh}
		</if>
		<if test="endTimeSh!=null and endTimeSh!=''">
			and  e.examine_time &lt;=#{endTimeSh}
		</if>
		<if test="startTimeBl!=null and startTimeBl!=''">
			and  e.handle_time &gt;=#{startTimeBl}
		</if>
		<if test="endTimeBl!=null and endTimeBl!=''">
			and  e.handle_time &lt;=#{endTimeBl}
		</if>
	</select>
    <!-- 加载呈批事项下拉框-->
	<select id="listBatchByTypeId" resultMap="BatchMapper" parameterType="Integer">
    SELECT ba.id as id ,ba.case_type as caseType,ba.content as content FROM `eva_batch_item` ba where case_type =#{typeId};
	</select>

	<!--加载办案单位的下拉框 -->
	<select id="selectAllInterrogateArea" resultType="com.zhixin.zhfz.bacs.entity.AreaEntity">
	select id as id,name as name from xt_organization  order by id
	</select>
    <!--加载创建人的下拉框 -->
	<select id="selectAllUser" resultMap="UserMapper">
    SELECT id as id,real_name as realName FROM `xt_user`;
	</select>
	<!--加载公用民警列表的dialog sql-->
	<select id="selectUserCommon" resultMap="UserMapper" parameterType="java.util.Map">
		SELECT u.id as id,u.login_name as loginName,u.real_name as realName,org.name as organization  FROM `xt_user` u  LEFT JOIN xt_organization org ON org.id = u.organization_id
		where 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			AND  ${dataAuth}
		</if>
		<if test="orgId!=null and orgId!=''">
			AND org.id = #{orgId}
		</if>
		ORDER  BY  u.id asc
		limit #{pageStart},#{pageEnd}
	</select>
    <!-- 分页查询警员数量-->
    <select id="selectUserCommonCount" resultType="Integer" parameterType="java.util.Map">
		SELECT count(u.id) FROM `xt_user` u  LEFT JOIN xt_organization org ON org.id = u.organization_id
		where 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			AND  ${dataAuth}
		</if>
		<if test="orgId!=null and orgId!=''">
			AND org.id = #{orgId}
		</if>
	</select>
    <!--带参数的查询userCommon查询 -->
	<select id="selectUserCommonParam" resultMap="UserMapper" parameterType="java.util.Map">
		SELECT u.id as id,u.login_name as loginName,u.real_name as realName,org.name as organization , org.`name` as areaName FROM `xt_user` u LEFT join xt_organization org ON u.organization_id = org.id
		where 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			AND  ${dataAuth}
		</if>
		<if test="mjjh!=null and mjjh!=''">
			AND  (u.login_name LIKE CONCAT('%','${mjjh}','%' ))
		</if>
		<if test="mjxm!=null and mjxm!=''">
			AND  (u.real_name LIKE CONCAT('%','${mjxm}','%' ))
		</if>
		<if test="mjdw!=null and mjdw!=100">
			AND  ${orgId}
		</if>  ORDER  BY  u.id asc  limit #{pageStart},#{pageEnd}
	</select>
	<!--带参数的查询userCommon查询 分页count-->
	<select id="selectUserCommonParamCount" resultType="Integer" parameterType="java.util.Map">
		SELECT count(u.id) FROM `xt_user` u LEFT join xt_organization org ON u.organization_id = org.id
		where 1=1
		<if test="dataAuth!=null and dataAuth!=''">
			AND  ${dataAuth}
		</if>
		<if test="mjjh!=null and mjjh!=''">
			AND  (u.login_name LIKE CONCAT('%','${mjjh}','%' ))
		</if>
		<if test="mjxm!=null and mjxm!=''">
			AND  (u.real_name LIKE CONCAT('%','${mjxm}','%' ))
		</if>
		<if test="mjdw!=null and mjdw!=100">
			AND  ${orgId}
		</if>
	</select>

	<!--查询考评标准的所有项 -->
	<select id="selectAllQuota" parameterType="java.util.Map" resultMap="quotaMapper">
         SELECT  id as id , item as Item , scoring_stand as ScoringStand ,pointsvalue as PointsValue from eva_quota
	</select>
	<!--查询出所有的item -->
	<select id="selectAllItem" resultType="com.zhixin.zhfz.jxkp.entity.ItemEntity" >
         select * from eva_item  i
         WHERE  1=1

	</select>
	<select id="selectQuotaByItem" parameterType="java.util.Map" resultMap="quotaMapper">
  		SELECT  id as id , item as Item , scoring_stand as ScoringStand ,pointsvalue as PointsValue from eva_quota WHERE  (scoring_stand LIKE CONCAT('%','${scoringStand}','%') or item LIKE CONCAT('%','${scoringStand}','%'))
  		<if test="caseType!=null and caseType!=''">
			AND type like '%${caseType}%'
		</if>
		<if test="item!=null and item!=''">
			AND item like '%${item}%'
		</if>
		limit #{pageStart},#{pageEnd}
  	</select>

	<select id="selectQuotaByItemCount" parameterType="java.util.Map" resultType="Integer">
		SELECT  count(1) from eva_quota WHERE  (scoring_stand LIKE CONCAT('%','${scoringStand}','%') or item LIKE CONCAT('%','${scoringStand}','%'))
		<if test="caseType!=null and caseType!=''">
			AND type like '%${caseType}%'
		</if>
		<if test="item!=null and item!=''">
			AND item like '%${item}%'
		</if>
	</select>
	<!--增加审核意见 -->
	<insert id="addSomeExamin" parameterType="com.zhixin.zhfz.jxkp.form.ExamineForm">
    INSERT  INTO  eva_examine (quota_id,dutypolice_id,context,eva_id,pointsvalue,status) VALUES (#{subQuotaId},#{subPoliceNo},#{subContext},#{subEvaId},#{subPointValue},#{subStatus})
	</insert>
	<!--增加一条考评记录-->
	<insert id="addOneEvaluation" parameterType="com.zhixin.zhfz.jxkp.form.BaseInformationForm">
     INSERT INTO  evaluation (case_no,case_name,case_desc,case_type,batch_item_id,informant,suspect,police_id,oraganizationId,leader_id,creater,handle_time,examine_time,scorevalue,pointsvalue,implementation,accordwith,remarks,lawer_id,law_according,exist_evidence,lawerOpinion,op_pid)
     VALUES  (#{subCaseNo},#{subCaseName},#{subCaseDesc},#{subAjxz},#{subCpsx},#{subBar},#{subXyr},#{subZcA},#{subOrgId},#{subLederIdA},#{subCreaterId},#{subWorkTime},#{subHandleTime},#{subScorevalue},#{pointsvalue},#{subImplementation},#{subAccordwith},#{subRemarks},#{lawerId},#{lawAccording},#{existEvidence},#{lawerOpinion},#{opPid})
	</insert>

	<insert id="addPoliceJoin" parameterType="com.zhixin.zhfz.jxkp.form.EvaPoliceJoinForm">
    INSERT INTO  eva_join SET eva_id = #{evaId},user_id = #{policeJoinId}

	</insert>
	<!--查询出数据库最新增加的evaluation记录的id-->
	<select id="selectMaxId" resultType="java.lang.Integer">
    SELECT MAX(id) from evaluation
	</select>
	<!-- 根据民警的id查询出民警的真实姓名-->
	<select id="selectRealNameById" parameterType="String" resultType="String">
    SELECT  real_name from `xt_user` WHERE  ID = #{userId}
	</select>
    <!-- 查询警号-->
	<select id="selectPoliceNoById" parameterType="String" resultType="String">
		SELECT  login_name from `xt_user` WHERE  ID = #{userId}
	</select>
	<!-- 查询一条记录所对应的协办民警-->
	<select id="selectEvaJoinByEvaId" parameterType="String" resultMap="evaJoinMapper">
    SELECT evaJoin.id as id , evaJoin.eva_id as evaId,evaJoin.user_id as userId  FROM  eva_join  evaJoin WHERE  eva_id = #{evaId}
	</select>
    <!--更新考评记录表-->
	<update id="updateOneEva" parameterType="com.zhixin.zhfz.jxkp.form.BaseUpdEvaForm">
        UPDATE evaluation
		set
	            batch_item_id = #{subCpsx},
				case_no = #{subCaseNo},
				case_name = #{subCaseName},
				case_type = #{subAjxz},
				informant = #{subBar},
				suspect = #{subXyr},
				police_id = #{subZcA},
				case_desc = #{subAqDesc},
				oraganizationId = #{subOrgId},
				leader_id = #{subLederIdA},
				handle_time = #{subWorkTime},
				examine_time = #{subHandleTime},
				implementation = #{subImplementation},
				scorevalue = #{subScorevalue},
				pointsvalue = #{pointsvalue},
				accordwith = #{subAccordwith},
				remarks = #{subRemarks},
				law_according = #{flyl},
				exist_evidence = #{xyzj},
				lawerOpinion = #{lawerOpinion}
		         where id = #{caseIdU}
    </update>
   <!-- 删除相同evaId的eva_join表记录-->
	<delete id="deleteSomeEvaJoinByEvaId" parameterType="String">
    DELETE  FROM  eva_join WHERE eva_id = #{evaId}
	</delete>
	<!--查询出呈批事项-->
	<select id="selectCpsx" parameterType="String" resultType="String">
    select batch_item_id from evaluation where id = #{evaId}
	</select>
	<!--根据id查询出评分标准-->
	<select id="selectOneQuotaById" parameterType="String" resultType="String">
     SELECT  scoring_stand from eva_quota WHERE  id = #{quotaId}
	</select>
	<!--修改考评记录时候自动加载已有的审核意见-->
	<select id="selectAllExamineByEvaId" parameterType="String" resultMap="examineMapper">
    SELECT e.id as id,e.quota_id as quotaId,e.dutypolice_id as dutypoliceId,e.context as context ,e.pointsvalue as pointsValue ,e.status as status FROM  eva_examine e
    WHERE e.eva_id = #{evaId}
	</select>
    <!--删除该纪录下的所有考评意见 -->
	<delete id="deleteSomeExamByevaId" parameterType="String" >
    DELETE  FROM  eva_examine WHERE  eva_id = #{evaId}
	</delete>
    <!--根据id删除一条考评记录-->
	<delete id="deleteOneEvaById" parameterType="String">
    DELETE  FROM  evaluation WHERE  id = #{evaId}
	</delete>
<!--根据id查询考评记录信息-->
	 <select id="selectOneEvaById" parameterType="String" resultMap="EvaluationMapper">
    SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,area.name as oraganizationName,e.leader_id as leaderId ,e.creater as createrId, e.handle_time as handleTime, e.examine_time as examineTime, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,u.real_name as police,bat.content as batchItem,e.lawerOpinion as lawerOpinion  FROM evaluation e  LEFT  join ba_area area on  area.organization_id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
   where e.id = #{evaId}
	 </select>
<!-- 根据考评编号查询该编号的数量-->
	<select id="selectCountOfCaseNo" parameterType="String" resultType="Integer">
    SELECT  count(*) from evaluation where case_no = #{caseNo}
	</select>
	<!-- 带参数查询-->
	<select id="selectAllEvaliationByParamWord" resultMap="EvaluationMapper" parameterType="java.util.Map">
		SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,area.name as oraganizationName,e.leader_id as leaderId ,e.creater as createrId, e.handle_time as handleTime, e.examine_time as examineTime, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,e.lawer_id as lawerId,u.real_name as police,bat.content as batchItem ,e.law_according as lawAccording,e.exist_evidence as existEvidence,e.lawerOpinion as lawerOpinion FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		WHERE 1=1
		<if test="evaId!=null and evaId!=''">
			AND  e.id = #{evaId}
		</if>
		<if test="caseNo!=null and caseNo!=''">
			AND  e.case_no = #{caseNo}
		</if>
		ORDER  BY  e.examine_time ASC
	</select>

	<!-- 带参数查询-->
	<select id="selectAllEvaliationByEvaId" resultMap="EvaluationMapper" parameterType="java.util.Map">
		SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,area.name as oraganizationName,e.leader_id as leaderId ,e.creater as createrId, e.handle_time as handleTime, e.examine_time as examineTime, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,e.law_according as lawAccording,e.exist_evidence as existEvidence, e.lawer_id as lawerId,u.real_name as police,bat.content as batchItem,e.lawerOpinion as lawerOpinion   FROM evaluation e  LEFT  join xt_organization area on  area.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		WHERE 1=1
		AND  e.id = #{evaId}
		ORDER  BY  e.examine_time ASC
	</select>

	<!--打印的时候查询对应的审核意见集合-->
	<select id="selectAllExamineByEvaIdPrint" parameterType="String" resultMap="examineMapper">
    SELECT e.id as id,e.quota_id as quotaId,e.dutypolice_id as dutypoliceId,e.context as context ,e.pointsvalue as pointsValue,u.real_name as  dutyPoliceNameAndNo FROM  eva_examine e LEFT JOIN `xt_user` u on u.id = e.dutypolice_id  where e.eva_id  = #{evaId}
	</select>

	<select id="selectOrgIdsOfOrg" parameterType="java.util.Map" resultType="com.zhixin.zhfz.bacs.entity.AreaEntity">
		select id as id,organization as name from xt_organization  WHERE  organization LIKE CONCAT('%','${text}','%' )
	</select>
     <!-- 根据警号查询出民警的id-->
	<select id="selectUserByNo" parameterType="String" resultType="String">
        select id from `xt_user` where login_name = #{loginName}
	</select>
	<select id="addXx" parameterType="java.util.Map">
		insert into xx(xxbt,xxnr,xxlx,cjyh_id,zt,xxdj,fssj) values(#{xxbt},#{xxnr},#{xxlx},#{cjyh_id},#{zt},#{#xxdj},now())
	</select>
	<select id="getMaxXxId" resultType="java.lang.Integer">
		select max(id) from xx
	</select>
	<insert id="addXxReceiver" parameterType="java.util.Map">
		insert into xx_receiver(xx_id,yh_id,`read`) values(#{xxid},#{yhid},0)
	</insert>
	<select id="selectXxPolice"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (
			SELECT u.id,u.real_name,u.login_name FROM evaluation e ,`xt_user` u WHERE e.police_id = u.id and e.id=#{id}
			UNION
			SELECT u2.id,u2.real_name,u2.login_name FROM eva_join ej,`xt_user` u2 WHERE ej.user_id = u2.id and ej.eva_id=#{id}
		) as a
	</select>

	<!--根据案件编号查询考评记录信息-->
	<select id="selectEvaByAjbh" parameterType="String" resultMap="EvaluationMapper">
        SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,org.name as oraganizationName,e.leader_id as leaderId ,e.creater as createrId, e.handle_time as handleTime, e.examine_time as examineTime, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,u.real_name as police,bat.content as batchItem,e.lawerOpinion as lawerOpinion  FROM evaluation e  LEFT  join xt_organization org  on  org.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		where e.case_no = #{caseNo} ORDER  BY  e.handle_time
	</select>

	<!--根据案件编号查询考评记录信息数量-->
	<select id="selectEvaByAjbhCount" parameterType="String" resultType="Integer">
        SELECT count(1)  FROM evaluation e  LEFT  join xt_organization org  on  org.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		where e.case_no = #{caseNo}
	</select>

	<select id="selectSonsOrgId" parameterType="String" resultType="String">
      select  id FROM  xt_organization WHERE parent_id = #{parentId}
	<!-- select  org_id id FROM  r_organization WHERE parent_org_id = #{parentId} -->
 </select>
 <!--此处是分界线==============================以上是投入使用的南沙版本考评系统=======================================以下是清远的定制需求 -->
	<!--根据id查询一个考评记录 -->
	<select id="selectEvaByEvaId" parameterType="String" resultMap="EvaluationMapper">
		SELECT e.id as id,e.oraganizationId as oraganizationId, e.case_no as caseNo ,e.case_name as caseName ,e.case_desc as caseDesc,e.case_type as caseType,e.batch_item_id as batchItemId ,e.informant as informant,e.suspect as suspect,e.police_id as policeId,org.name as oraganizationName,e.leader_id as leaderId ,e.creater as createrId, e.handle_time as handleTime, e.examine_time as examineTime, e.scorevalue as scoreValue ,e.pointsvalue as pointsValue,e.implementation as implementation,e.accordwith as accordWith,e.remarks as remarks ,u.real_name as police,bat.content as batchItem,e.lawerOpinion as lawerOpinion  FROM evaluation e  LEFT  join xt_organization org  on  org.id = e.oraganizationId left JOIN  `xt_user`  u    ON  u.id  =  e.police_id LEFT  join  eva_batch_item bat on e.batch_item_id = bat.id
		where e.id = #{evaId}
	</select>
	<!--删除该eva_examine_change表纪录下的所有考评意见 -->
	<delete id="deleteSomeExamByevaIdTabChange" parameterType="String" >
		DELETE  FROM  eva_examine_change WHERE  eva_id = #{evaId}
	</delete>
	<!--增加审核意见，插入到eva_examine_change表 -->
	<insert id="addSomeExaminTabChange" parameterType="com.zhixin.zhfz.jxkp.form.ExamineForm">
		INSERT  INTO  eva_examine_change (quota_id,dutypolice_id,context,eva_id,pointsvalue,eva_ask_status_id,status) VALUES (#{subQuotaId},#{subPoliceNo},#{subContext},#{subEvaId},#{subPointValue},#{statusId},#{subStatus})
	</insert>
	<!--更新考评记录表但是不更新得分数和扣分数-->
	<update id="updateOneEvaNoUpdScore" parameterType="com.zhixin.zhfz.jxkp.form.BaseUpdEvaForm">
		UPDATE evaluation
		set
		batch_item_id = #{subCpsx},
		case_no = #{subCaseNo},
		case_name = #{subCaseName},
		case_type = #{subAjxz},
		informant = #{subBar},
		suspect = #{subXyr},
		police_id = #{subZcA},
		case_desc = #{subAqDesc},
		oraganizationId = #{subOrgId},
		leader_id = #{subLederIdA},
		handle_time = #{subWorkTime},
		examine_time = #{subHandleTime},
		implementation = #{subImplementation},
		accordwith = #{subAccordwith},
		remarks = #{subRemarks},
		law_according = #{flyl},
		exist_evidence = #{xyzj},
		lawerOpinion = #{lawerOpinion}
		where id = #{caseIdU}
	</update>
	<!--增加待领导批准的修改记录，插入到eva_ask_status表 -->
	<insert id="addOneAskStatus" parameterType="com.zhixin.zhfz.jxkp.entity.AskStatusEntity">
		INSERT  INTO  eva_ask_status (eva_id,ask_uesrId,old_dfz,old_kfz,new_dfz,new_kfz,status,create_time,ajbh,ajmc) VALUES (#{evaId},#{askUserId},#{oldDfz},#{oldKfz},#{newDfz},#{newKfz},#{status},now(),#{ajbh},#{ajmc})
	</insert>

	<!--加载请求批复的列表 -->
	<select id="selectAskStatus" parameterType="java.util.Map" resultMap="askStatusMapper">
          select eas.id as id,eas.eva_id as evaId,eas.ajbh as ajbh,eas.ajmc as ajmc ,eas.ask_uesrId as askUserId,eas.old_dfz as oldDfz,eas.old_kfz as oldKfz ,eas.new_dfz as newDfz ,eas.new_kfz as newKfz,eas.status as status,eas.reply_leaderId as replyLeaderId,eas.create_time as createTime
         ,u.real_name as realNameAsk ,u1.real_name as realNameReply,e.case_type as caseType
         from eva_ask_status eas LEFT JOIN `xt_user`  u on eas.ask_uesrId = u.id LEFT JOIN `xt_user`  u1 on eas.reply_leaderId = u1.id LEFT JOIN evaluation e ON e.id = eas.eva_id
		WHERE  1=1
		<if test="ajbh!=null and ajbh!=''">
			AND  (eas.ajbh LIKE CONCAT('%','${ajbh}','%' ))
		</if>
		<if test="ajmc!=null and ajmc!=''">
			AND  (eas.ajmc LIKE CONCAT('%','${ajmc}','%' ))
		</if>
		<if test="fzyxm!=null and fzyxm!= ''">
			AND  (u.real_name LIKE CONCAT('%','${fzyxm}','%' ))
		</if>
		<if test="status!=null and status!=''">
			AND  (e.case_type = #{status})
		</if>
        order by create_time desc
        limit  #{pageStart},#{pageEnd}
	</select>
	<!--加载请求批复的列表总条数 -->
	<select id="selectAskStatusCount" parameterType="java.util.Map" resultType="String">
		select count(1)
		from eva_ask_status eas LEFT JOIN `xt_user`  u on eas.ask_uesrId = u.id LEFT JOIN `xt_user`  u1 on eas.reply_leaderId = u1.id LEFT JOIN evaluation e ON e.id = eas.eva_id
		WHERE  1=1
		<if test="ajbh!=null and ajbh!=''">
			AND  (eas.ajbh LIKE CONCAT('%','${ajbh}','%' ))
		</if>
		<if test="ajmc!=null and ajmc!=''">
			AND  (eas.ajmc LIKE CONCAT('%','${ajmc}','%' ))
		</if>
		<if test="fzyxm!=null and fzyxm!= ''">
			AND  (u.real_name LIKE CONCAT('%','${fzyxm}','%' ))
		</if>
		<if test="status!=null and status!=''">
			AND  (e.case_type = #{status})
		</if>
		order by create_time desc
	</select>
	<!--修改成功过后删除待修改表申请记录 -->
	<delete id="deleteOneAskStatus" parameterType="String">
        delete from eva_ask_status WHERE  eva_id = #{evaId}
	</delete>
	<!--修改考评记录时候自动加载已有的审核意见-->
	<select id="selectAllExamineFromTabExamineChangeByEvaId" parameterType="java.util.Map" resultMap="examineMapper">
		SELECT e.id as id,e.quota_id as quotaId,e.dutypolice_id as dutypoliceId,e.context as context ,e.pointsvalue as pointsValue,e.status as status  FROM  eva_examine_change e
		WHERE e.eva_id = #{evaId} and e.eva_ask_status_id = #{id}
	</select>
	<!--查询eva_ask_status数据库最新的id-->
	<select id="selectMaxIdTabAskStatus" resultType="java.lang.String">
    SELECT MAX(id) from eva_ask_status
	</select>
	<!--更新基础表evaluation的得分值扣分值情况-->
	<update id="updateEvaScoreAndPoint" parameterType="java.util.Map">
		UPDATE evaluation
		set
		scorevalue = #{subScorevalue},
		pointsvalue = #{pointsvalue}
		where id = #{evaId}
	</update>
	<!--根据id请求一条批复 -->
	<select id="selectOneAskStatusById" parameterType="String" resultMap="askStatusMapper">
		select eas.id as id,eas.eva_id as evaId,eas.ajbh as ajbh,eas.ajmc as ajmc ,eas.ask_uesrId as askUserId,eas.old_dfz as oldDfz,eas.old_kfz as oldKfz ,eas.new_dfz as newDfz ,eas.new_kfz as newKfz,eas.status as status,eas.reply_leaderId as replyLeaderId,eas.create_time as createTime
		,u.real_name as realNameAsk ,u1.real_name as realNameReply
		from eva_ask_status eas LEFT JOIN `xt_user`  u on eas.ask_uesrId = u.id LEFT JOIN `xt_user`  u1 on eas.reply_leaderId = u1.id
		where eas.id = #{id}
		order by create_time desc
	</select>
	<!-- 更新待批复的申请表 -->
	<update id="updateOneStatusChange" parameterType="java.util.Map">
        update eva_ask_status set status = #{status},reply_leaderId = #{replyleaderId} where id = #{id}
	</update>
    <!--整改统计占比 -->
	<select id="selectRate" resultMap="rateMapper" parameterType="java.util.Map">
	select a.aid as id,a.ano as caseNo,a.aname as caseName,a.afz as afz,b.bfm as bfm ,a.atype as caseType,u.real_name as realName,CONCAT(ROUND(a.afz/b.bfm *100,2),'','%') as rate from
	(SELECT
	evaluation.id as aid,
	evaluation.case_no ano,
	evaluation.case_name as aname,
	evaluation.case_type as atype,
	evaluation.police_id as apoliceId,
	count(*) as afz
	FROM
	evaluation
	LEFT JOIN eva_examine ON evaluation.id = eva_examine.eva_id  WHERE eva_examine.status =1 GROUP BY evaluation.id) as a LEFT JOIN (SELECT
	evaluation.case_no as bno,
	count(*) as bfm
	FROM
	evaluation
	LEFT JOIN eva_examine ON evaluation.id = eva_examine.eva_id GROUP BY evaluation.case_no) as b on a.ano = b.bno LEFT JOIN `xt_user` u on u.id =  a.apoliceId
    where 1=1
		<if test="ajbh!=null and ajbh!=''">
			AND  (a.ano LIKE CONCAT('%','${ajbh}','%' ))
		</if>
		<if test="ajmc!=null and ajmc!=''">
			AND  (a.aname LIKE CONCAT('%','${ajmc}','%' ))
		</if>
		<if test="fzyxm!=null and fzyxm!= ''">
			AND  (u.real_name LIKE CONCAT('%','${fzyxm}','%' ))
		</if>
</select>

	<select id="selectRateCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from
		(SELECT
		evaluation.id as aid,
		evaluation.case_no ano,
		evaluation.case_name as aname,
		evaluation.case_type as atype,
		evaluation.police_id as apoliceId,
		count(*) as afz
		FROM
		evaluation
		LEFT JOIN eva_examine ON evaluation.id = eva_examine.eva_id  WHERE eva_examine.status =1 GROUP BY evaluation.id) as a LEFT JOIN (SELECT
		evaluation.case_no as bno,
		count(*) as bfm
		FROM
		evaluation
		LEFT JOIN eva_examine ON evaluation.id = eva_examine.eva_id GROUP BY evaluation.case_no) as b on a.ano = b.bno LEFT JOIN `xt_user` u on u.id =  a.apoliceId
		where 1=1
		<if test="ajbh!=null and ajbh!=''">
			AND  (a.ano LIKE CONCAT('%','${ajbh}','%' ))
		</if>
		<if test="ajmc!=null and ajmc!=''">
			AND  (a.aname LIKE CONCAT('%','${ajmc}','%' ))
		</if>
		<if test="fzyxm!=null and fzyxm!= ''">
			AND  (u.real_name LIKE CONCAT('%','${fzyxm}','%' ))
		</if>
	</select>
	<delete id="delOneAskStatus" parameterType="String">
         delete from eva_ask_status where id = #{id}
	</delete>

	<insert id="insertOneInform" parameterType="com.zhixin.zhfz.common.entity.InformEntity">
          insert into xt_schedule  (sender_id,receiver_id,title,content,status,happen_time,ajbh,ajmc,system_name)
          VALUES  (#{senderId},#{receiverId},#{title},#{content},0,now(),#{ajbh},#{ajmc},'KP')
	</insert>

	<select id="selectOrgCodeByOrgId" parameterType="String" resultType="String">
		SELECT org_code FROM `xt_organization` where id = #{orgId}
	</select>

	<select id="listConfig" resultMap="configMapper" parameterType="java.util.Map">
		select * from gd_jz_syn_pz
		<if test="type!=null and type !=''">
			where type=#{type}
		</if>
	</select>

	<select id="listAjxx" resultMap="ajxxMapper" parameterType="java.util.Map">
		select ajmc, ajbh,zbdw,(select name from xt_organization where org_code=a.zbdw LIMIT 1) zbdw_cn,ajstate,
		ajlx,fasjzz,ab,sljjsj,sl_bjslh,fadd,zyaq,reservation01,ajzbry,jzbh,sl_slsj from gd_jz_aj a
		<where>
			<if test="caseName!=null and caseName!=''">
				and a.ajmc like '%${caseName}%'
			</if>
			<if test="caseNo!=null and caseNo!=''">
				and a.ajbh like '%${caseNo}%'
			</if>
			<if test="startTime!=null and startTime!=''">
				and a.SLJJSJ &gt;= #{startTime}
			</if>
			<if test=" endTime!=null and endTime !=''">
				and a.SLJJSJ &lt;= #{endTime}
			</if>
			<if test="orgCode!=null and orgCode!=''">
				and a.SLJSDW = #{orgCode}
			</if>

		</where>
		limit ${pageStart},${rows}
	</select>

	<select id="countAjxx" resultType="int" parameterType="java.util.Map">
		select count(1) from gd_jz_aj a
		<where>
			<if test="caseName!=null and caseName!=''">
				and a.ajmc like '%${caseName}%'
			</if>
			<if test="caseNo!=null and caseNo!=''">
				and a.ajbh like '%${caseNo}%'
			</if>
			<if test="startTime!=null and startTime!=''">
				and a.SLJJSJ &gt;= #{startTime}
			</if>
			<if test=" endTime!=null and endTime !=''">
				and a.SLJJSJ &lt;= #{endTime}
			</if>
			<if test="orgCode!=null and orgCode!=''">
				and a.SLJSDW = #{orgCode}
			</if>
		</where>
	</select>

	<select id="listAllOrgAndParent" resultMap="organizationResultMap">
		SELECT * FROM xt_organization o LEFT JOIN xt_organization o2 on  o.id = o2.id
	</select>

	<select id="selectUsers" resultMap="UserMapper" parameterType="java.util.Map">
		SELECT u.id as id,u.login_name as loginName,u.real_name as realName,org.name as organization  FROM `xt_user` u  LEFT JOIN xt_organization org ON org.id = u.organization_id
		where 1=1
		<if test="orgId!=null and orgId!=''">
			AND org.id = #{orgId}
		</if>
	</select>

	<select id="selectRateSign" resultMap="RateSignMapper">
        select  (CASE is_read when '1' THEN '已确认签领' WHEN '0' THEN '未确认签领'  END  )  as name, count(*)  as value from ba_inform  where type = 2  and DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(send_time)  GROUP BY is_read
	</select>

	<select id="selectRateChange" resultMap="RateSignMapper">
        SELECT  (CASE status WHEN '1' THEN '审批已通过' WHEN '0' THEN '审批未通过' END) as name ,count(*) as value FROM `eva_ask_status` where  DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(create_time) GROUP BY `status`;
	</select>
	<select id="getfazhiyuanTop10" resultMap="RateSignMapper">
	select
		`xt_user`.real_name as name ,count(*) as value
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.creater
		AND o.id = xt_user.organization_id
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		GROUP BY e.creater
		ORDER BY count(*) DESC LIMIT 10
	</select>
	<select id="getdutypoliceTop10" resultMap="RateSignMapper">
	select
		`xt_user`.real_name as name ,SUM(ex.pointsvalue) as value
		from evaluation e,
		eva_examine ex,
		`xt_user`,
		xt_organization o
		WHERE
		e.id = ex.eva_id
		AND ex.dutypolice_id = `xt_user`.id
		AND o.id = xt_user.organization_id
			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		GROUP BY ex.dutypolice_id
		order by value Asc LIMIT 10
	</select>
	<select id="getShenherenTop10" resultMap="RateSignMapper">
	select
		`xt_user`.real_name as name,count(*) as value
		from evaluation e,
		`xt_user`,
		xt_organization o
		WHERE
		`xt_user`.id = e.leader_id
		AND o.id = `xt_user`.organization_id

			and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)

		GROUP BY e.leader_id
		ORDER BY value DESC LIMIT 10
	</select>

	<select id="selectRateFzday" resultMap="RateSignMapper">
		select DATE_FORMAT(examine_time,'%Y-%m-%d') as name,count(*) as value from evaluation where DATE_SUB(CURDATE(),INTERVAL 30 DAY) &lt;= examine_time GROUP BY name;
	</select>
	<select id="selectRateFzByday" resultMap="RateSignMapper">
		SELECT
		DATE_FORMAT(examine_time, '%Y-%m-%d') AS NAME,
		count(*) AS
		VALUE

		FROM
		evaluation
		WHERE
		<if test="day != '' and day != null">
		DATE_SUB(CURDATE(), INTERVAL ${day} DAY) &lt;= examine_time
		</if>
		GROUP BY
		NAME;
	</select>

	<select id="selectCaseNumOfOrg" resultMap="RateSignMapper">
        select org.`name` as name,count(*) as value from evaluation eva LEFT JOIN xt_organization org on eva.oraganizationId = org.id GROUP BY eva.oraganizationId
	</select>

	<update id="updScheduleById" parameterType="String">
		update xt_schedule set status =1,handler_time=now()  where id=#{id}
	</update>


	<select id="getbjdwtjVisual" resultType="com.zhixin.zhfz.jxkp.entity.BJDWTJEntity" parameterType="java.util.Map">
		select e.oraganizationId jbdwid,o.name jbdw, count(*) kpsl,SUM(e.pointsvalue) kf_sum from evaluation e,xt_organization o
		where e.oraganizationId = o.id
		and (e.case_type = 0 or e.case_type = 1 or e.case_type = 2)
		GROUP BY o.name
		ORDER BY AVG(e.scorevalue) DESC
	</select>

	<select id="getbjdwtjVisualCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(*) from evaluation e
		WHERE e.oraganizationId = #{jbdw} GROUP BY e.case_no
	</select>
   </mapper>


