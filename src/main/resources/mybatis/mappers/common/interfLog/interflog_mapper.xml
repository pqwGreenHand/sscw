<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.zhixin.zhfz.common.dao.interfLog.IInterfLogMapper">

    <resultMap id="interfLogResultMap" type="com.zhixin.zhfz.common.entity.InterfLogEntity">
       <id property="id" column="id"/>
       <result property="type" column="type"/>
       <result property="content" column="content"/>
       <result property="user" column="user"/>
       <result property="operTime" column="oper_time"/>
       <result property="isSuccess" column="is_success"/>
		<result column="op_pid" property="op_Pid" jdbcType="VARCHAR" />
		<result column="op_user_id" property="op_User_Id" jdbcType="INTEGER" />
    </resultMap>

    <select id="listInterfaceLog" parameterType="java.util.Map" resultMap="interfLogResultMap">  
       		<!-- no ";" at the end -->   
        	select * from xt_interface_log
			<where>
				1=1
				<if test="dataAuth!=null and dataAuth!=''">
					and ${dataAuth}
				</if>
	        	<if test="user!=null and user!=''">
					and user like '%${user}%'
				</if>
				<if test="content!=null and content!=''">
					and content like '%${content}%'
				</if>
				<if test="start_date!=null and start_date!=''">
					and oper_time &gt;=#{start_date}
				</if>
				<if test="end_date!=null and end_date!=''">
					and oper_time &lt;=#{end_date}
				</if>
			</where> 
			limit ${pageStart},${rows}
    </select>
    
    <select id="countInterfaceLog" resultType="java.lang.Integer" parameterType="java.util.Map">
    		select count(1) from xt_interface_log
    		<where> 
	        	<if test="user!=null and user!=''">
					and user like '%${user}%'
				</if>
				<if test="content!=null and content!=''">
					and content like '%${content}%'
				</if>
				<if test="start_date!=null and start_date!=''">
					and oper_time &gt;=#{start_date}
				</if>
				<if test="end_date!=null and end_date!=''">
					and oper_time &lt;=#{end_date}
				</if>
			</where>
    </select>
    
    <insert id="insertInterfaceLog" parameterType="com.zhixin.zhfz.common.entity.InterfLogEntity" keyProperty="id">  
            insert into xt_interface_log (type,content,user,oper_time,is_success) values(#{type},#{content},#{user},now(),#{isSuccess}) 
    </insert>

	<delete id="deleteInterfaceLog" parameterType="int">  
            delete from xt_interface_log where id=#{id}
    </delete>
    
    <delete id="cleanInterfaceLog">  
            delete from xt_interface_log where TIMEDIFF(now(),oper_time) &gt;=4800000
    </delete>
    
</mapper>